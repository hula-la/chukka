## 게임 아키텍처 설계

- 서버에서 클라이언트로 영상 두개를 보내는 방법을 계속 모색했음.

  - Json 객체로 묶어서 보내려고 시도함

    - 이미지를 통신하기 위한 데이터 형식인 `bytearray`는 Json 객체에 알맞지 않음.
    - 계속 시도하다가 우회함.

  - Json 말고 클라이언트에서 비동기로 할 수 있을까?

    - `async`로 구현해보려고 시도함.
      - 자바스크립트를 제대로 사용하지 못하는 상태로 구현하려고 하니, 디버깅 천국
      - 자바스크립트가 싱글 쓰레드라서 가능할지 의문

  - `multiple video stream`키워드로 계속 검색해도 나오지 않음.

  - `WebRTC`는 다자간 영상 통신이 가능한 걸로 아는데, 이 원리를 이용하면 웹소켓으로도 가능하지 않을까?

    <img src="https://user-images.githubusercontent.com/88833439/181462814-1cc2b276-a7a6-485f-a832-6fc5ce2d00ab.png" alt="image" style="zoom: 33%;" />

    - 중앙 서버를 통한 `SFU`서버를 사용하면 가능하지 않을까?
      - 하지만, 찾아보니 `node.js`코드만 나옴.. `Flask`와 `FastAPI` 코드는 나오지 않음...ㅜ
      - WebRTC를 찾아보니 영상이 통과되는 `미디어 서버`도 있음.
        - `kurento` 서버가 주로 쓰인다고 함.
        - 파이썬에서 분석한 영상들을 `kurento` 서버에 넣으면 안될까?

  - 생각해보니, 서버에서 클라이언트로 영상을 다시 받아오는 게 아니고 String 형식의 결과 값만 전달하면 Json 배열로도 가능하니 구현 난이도가 훨씬 쉬울 것 같음.

  - **최종 아키텍처 설계**

    - **싱글모드**
      - **[HTTP 통신]** 서버 -> 클라이언트 : 게임 시작할 때 요청을 보내면 서버에서 클라이언트로 강사 영상을 전달함
      - 게임 시작하면, 클라이언트의 웹캠 영상이 브라우저에 출력됨.
      - **[WebSocket]** 클라이언트 -> 서버 : 자신의 웹캠 영상을 0.1초마다 (**[javascript]**`setInterbal(0.1)`) `WebSocket 통신`으로 보냄.
      - 서버 -> 클라이언트: 클라이언트애서 전달된 영상을 분석하고 `유사도/점수`를 클라이언트로 보냄.
      - 서버에서 받은 결과값을 영상 위에 띄움 (**[css]**`display: absolute`)
    - **멀티모드**
      - 상대방의 영상/점수 를 `WebRTC`을 통해 통신함 

    

![image](https://user-images.githubusercontent.com/88833439/181464993-7af7367f-7c67-4214-9e2e-c0a421d28871.png)